<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Study Planner</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      background: linear-gradient(-45deg, #6a11cb, #2575fc, #00c6ff, #0072ff);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      transition: background 0.5s, color 0.5s;
    }
    body.dark {
      background: linear-gradient(-45deg, #141e30, #243b55, #0f2027, #2c5364);
    }

    .background-shapes { position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
    .shape { position: absolute; background: rgba(255,255,255,0.15); border-radius:50%; animation: float 20s infinite; }
    .shape:nth-child(1){width:120px;height:120px;left:10%;animation-duration:18s;}
    .shape:nth-child(2){width:200px;height:200px;left:40%;animation-duration:25s;}
    .shape:nth-child(3){width:150px;height:150px;left:70%;animation-duration:22s;}
    .shape:nth-child(4){width:100px;height:100px;left:85%;animation-duration:28s;}

    @keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    @keyframes float{0%{top:110%;transform:translateX(0) rotate(0deg)}50%{transform:translateX(20px) rotate(180deg)}100%{top:-200px;transform:translateX(-20px) rotate(360deg)}}

    header, section, #task-input {
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(12px);
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 20px auto;
      max-width: 1000px;
      transition: background 0.5s, color 0.5s;
    }
    body.dark header, body.dark section, body.dark #task-input {
      background: rgba(0,0,0,0.4);
      color: #eee;
    }

    header {
      text-align: center;
      color: white;
      font-size: 20px;
      font-weight: bold;
      position: relative;
      word-wrap: break-word;
    }

    .toggle-buttons {
      position: absolute;
      top: 10px;
      right: 15px;
      display: flex;
      gap: 10px;
    }
    .toggle-buttons button {
      background: rgba(255,255,255,0.3);
      border: none;
      padding: 6px 10px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      transition: 0.3s;
    }
    body.dark .toggle-buttons button { background: rgba(0,0,0,0.6); color:white; }

    #task-input {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
    }
    #task-input input, select, button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    #task-input button { background: #007bff; color: white; border: none; cursor: pointer; }
    #task-input button:hover { background: #0056b3; }

    body.compact #task-input { grid-template-columns: 1fr; }

    section h2 { text-align:center; color:white; }
    body.dark section h2 { color:#eee; }

    #task-list ul, #history-tasks { list-style:none; padding:0; }
    .task {
      background: rgba(255,255,255,0.3);
      border-radius: 10px;
      padding: 12px;
      margin: 8px 0;
      border-left: 5px solid #007bff;
      display:flex; justify-content:space-between; align-items:center;
      transition:0.3s;
    }
    body.dark .task { background: rgba(0,0,0,0.3); color:#eee; }

    .priority-high { border-left-color:#dc3545; }
    .priority-medium { border-left-color:#ffc107; }
    .priority-low { border-left-color:#28a745; }

    .task button { margin-left:5px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
    .edit-btn{background:#ffc107;color:white;}
    .delete-btn{background:#dc3545;color:white;}
    .done-btn{background:#28a745;color:white;}

    #progress { text-align:center; }
    #progressChart { max-width:250px; max-height:250px; margin:20px auto; display:block; }
    #progress-bar { width:100%; background:rgba(255,255,255,0.3); border-radius:10px; overflow:hidden; margin:15px 0; }
    #progress-fill { height:18px; width:0%; background:linear-gradient(90deg,#28a745,#00c851); transition:width 0.8s ease; border-radius:10px; }

    #search { margin:10px auto; padding:8px; width:100%; max-width:400px; border-radius:8px; border:1px solid #ccc; display:block; }

    #calendar { margin:20px auto; max-width:900px; display:grid; grid-template-columns:repeat(7,1fr); gap:5px; text-align:center; overflow-x:auto; }
    body.compact #calendar { grid-template-columns:1fr; }

    .day { background:rgba(255,255,255,0.3); border-radius:8px; padding:10px; min-height:120px; }
    body.dark .day { background:rgba(0,0,0,0.3); color:#eee; }

    .day h4 { margin:5px 0; font-size:14px; background:#007bff; color:white; padding:5px; border-radius:5px; }
    body.dark .day h4 { background:#00c6ff; color:black; box-shadow:0 0 10px #00c6ff; }

    .day-task { font-size:12px; background:#eef7ff; border-left:3px solid #007bff; padding:4px; margin:3px 0; border-radius:4px; text-align:left; color:#000; }
    body.dark .day-task { background:rgba(0,123,255,0.2); border-left:3px solid #00c6ff; color:#fff; box-shadow:0 0 8px rgba(0,198,255,0.5); }

    body.compact { font-size:14px; }
  </style>
</head>
<body>
  <div class="background-shapes">
    <div class="shape"></div><div class="shape"></div><div class="shape"></div><div class="shape"></div>
  </div>

  <header>
    <h1>üìò Smart Study Planner</h1>
    <div class="toggle-buttons">
      <button id="toggle-theme">üåô Dark Mode</button>
      <button id="toggle-compact">üì± Compact Mode</button>
    </div>
  </header>

  <section id="task-input">
    <input type="text" id="subject-name" placeholder="Subject (e.g. Math)">
    <input type="text" id="task-name" placeholder="Task (e.g. Chapter 5)">
    <input type="date" id="task-deadline">
    <input type="time" id="start-time">
    <input type="time" id="end-time">
    <select id="task-priority">
      <option value="low">Low Priority</option>
      <option value="medium">Medium Priority</option>
      <option value="high">High Priority</option>
    </select>
    <button onclick="addTask()">Add Task</button>
  </section>

  <input type="text" id="search" placeholder="üîç Search tasks..." onkeyup="searchTasks()">

  <section id="task-list">
    <h2>üìÖ Upcoming Tasks</h2>
    <ul id="tasks"></ul>
  </section>

  <section id="history">
    <h2>üìù Completed Tasks History</h2>
    <ul id="history-tasks"></ul>
  </section>

  <section id="progress">
    <h2>üìä Study Progress</h2>
    <div id="progress-bar"><div id="progress-fill"></div></div>
    <canvas id="progressChart"></canvas>
  </section>

  <section>
    <h2>üóì Weekly Schedule</h2>
    <div id="calendar"></div>
  </section>

  <script>
    let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    let historyTasks = JSON.parse(localStorage.getItem("historyTasks")) || [];
    let chart;

    function saveData() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
      localStorage.setItem("historyTasks", JSON.stringify(historyTasks));
    }

    function buildCalendar() {
      const calendar = document.getElementById("calendar");
      calendar.innerHTML = "";
      const today = new Date();
      const start = new Date(today);
      start.setDate(today.getDate() - today.getDay());

      for (let i = 0; i < 7; i++) {
        let date = new Date(start);
        date.setDate(start.getDate() + i);
        const dateStr = date.toISOString().split("T")[0];

        let dayDiv = document.createElement("div");
        dayDiv.className = "day";
        dayDiv.innerHTML = `<h4>${date.toDateString().split(" ").slice(0,3).join(" ")}<br>${dateStr}</h4>`;

        tasks.filter(t => t.deadline === dateStr)
             .sort((a,b) => a.start.localeCompare(b.start))
             .forEach(t => {
                let taskDiv = document.createElement("div");
                taskDiv.className = `day-task priority-${t.priority}`;
                taskDiv.innerText = `‚è∞ ${t.start}‚Äì${t.end} | üìò ${t.subject}: ${t.task}`;
                dayDiv.appendChild(taskDiv);
             });

        calendar.appendChild(dayDiv);
      }
    }

    function addTask() {
      const subject = document.getElementById("subject-name").value;
      const task = document.getElementById("task-name").value;
      const deadline = document.getElementById("task-deadline").value;
      const start = document.getElementById("start-time").value;
      const end = document.getElementById("end-time").value;
      const priority = document.getElementById("task-priority").value;

      if (!subject || !task || !deadline || !start || !end) {
        alert("‚ö†Ô∏è Please fill all fields!");
        return;
      }

      tasks.push({ subject, task, deadline, start, end, priority });
      saveData();
      document.getElementById("subject-name").value = "";
      document.getElementById("task-name").value = "";
      document.getElementById("task-deadline").value = "";
      document.getElementById("start-time").value = "";
      document.getElementById("end-time").value = "";
      renderTasks();
      updateProgress();
      buildCalendar();
    }

    function renderTasks() {
      const taskList = document.getElementById("tasks");
      const historyList = document.getElementById("history-tasks");
      taskList.innerHTML = "";
      historyList.innerHTML = "";
      const today = new Date().toISOString().split("T")[0];

      tasks.forEach((task, index) => {
        let li = document.createElement("li");
        li.className = `task priority-${task.priority}`;
        if(task.deadline < today) li.classList.add("overdue");
        else if(task.deadline === today) li.classList.add("due-today");

        li.innerHTML = `
          <span>
            üìò <b>${task.subject}</b> | üìù ${task.task} | 
            üìÖ ${task.deadline} | ‚è∞ ${task.start} ‚Äì ${task.end} | ‚≠ê ${task.priority.toUpperCase()}
          </span>
          <div>
            <button class="done-btn" onclick="markDone(${index})">‚úî</button>
            <button class="edit-btn" onclick="editTask(${index})">‚úè</button>
            <button class="delete-btn" onclick="deleteTask(${index})">üóë</button>
          </div>
        `;
        taskList.appendChild(li);
      });

      historyTasks.forEach((task, index) => {
        let li = document.createElement("li");
        li.className = `task priority-${task.priority}`;
        li.innerHTML = `
          <span>
            ‚úÖ üìò <b>${task.subject}</b> | üìù ${task.task} | Completed on: ${task.completedOn}
          </span>
          <div>
            <button class="edit-btn" onclick="undoTask(${index})">‚Ü© Undo</button>
          </div>
        `;
        historyList.appendChild(li);
      });
    }

    function markDone(index) {
      const task = tasks.splice(index, 1)[0];
      task.completedOn = new Date().toLocaleString();
      historyTasks.push(task);
      saveData();
      renderTasks();
      updateProgress();
      buildCalendar();
    }

    function undoTask(index) {
      const task = historyTasks.splice(index, 1)[0];
      delete task.completedOn;
      tasks.push(task);
      saveData();
      renderTasks();
      updateProgress();
      buildCalendar();
    }

    function editTask(index) {
      const newSubject = prompt("Edit Subject:", tasks[index].subject);
      const newTask = prompt("Edit Task:", tasks[index].task);
      const newDate = prompt("Edit Deadline (YYYY-MM-DD):", tasks[index].deadline);
      const newStart = prompt("Edit Start Time (HH:MM):", tasks[index].start);
      const newEnd = prompt("Edit End Time (HH:MM):", tasks[index].end);
      if(newSubject && newTask && newDate && newStart && newEnd){
        tasks[index] = { ...tasks[index], subject:newSubject, task:newTask, deadline:newDate, start:newStart, end:newEnd };
        saveData();
        renderTasks();
        buildCalendar();
      }
    }

    function deleteTask(index) {
      if(confirm("‚ö†Ô∏è Are you sure you want to delete this task?")) {
        tasks.splice(index, 1);
        saveData();
        renderTasks();
        updateProgress();
        buildCalendar();
      }
    }

    function searchTasks() {
      const query = document.getElementById("search").value.toLowerCase();
      document.querySelectorAll("#tasks .task").forEach(task => {
        task.style.display = task.textContent.toLowerCase().includes(query) ? "flex" : "none";
      });
    }

    function updateProgress() {
      const completed = historyTasks.length;
      const progress = (completed / (completed + tasks.length)) * 100 || 0;
      document.getElementById("progress-fill").style.width = progress + "%";

      const ctx = document.getElementById("progressChart").getContext("2d");
      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ["Completed", "Pending"],
          datasets: [{ data: [completed, tasks.length], backgroundColor: ["#28a745","#ffc107"] }]
        },
        options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:"bottom", labels:{ color:"#fff" }}} }
      });
    }

    document.getElementById("toggle-theme").addEventListener("click", () => {
      document.body.classList.toggle("dark");
      document.getElementById("toggle-theme").textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
    });

    document.getElementById("toggle-compact").addEventListener("click", () => {
      document.body.classList.toggle("compact");
      document.getElementById("toggle-compact").textContent = document.body.classList.contains("compact") ? "üñ•Ô∏è Full Mode" : "üì± Compact Mode";
    });

    renderTasks();
    updateProgress();
    buildCalendar();
  </script>
</body>
</html>
